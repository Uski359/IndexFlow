groups:
  - name: index-node
    rules:
      - alert: IndexerLagHigh
        expr: indexflow_safe_block_number - indexflow_last_indexed_block > 50
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: Indexer is behind the safe head
          description: |
            indexflow_last_indexed_block is {{ $value | printf "%.0f" }} blocks behind safe head on {{ $labels.chainId }}.

      - alert: CoordinatorSubmissionErrors
        expr: increase(indexflow_onchain_submissions_total{result="error"}[5m]) > 0
        for: 0m
        labels:
          severity: warning
        annotations:
          summary: Coordinator submission errors detected
          description: |
            Coordinator reported on-chain submission errors in the last 5 minutes for {{ $labels.chainId }}.

      - alert: GraphQLErrorRateHigh
        expr: |
          (
            sum(rate(indexflow_graphql_requests_total{success="false"}[5m]))
            /
            sum(rate(indexflow_graphql_requests_total[5m]))
          ) > 0.05
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: GraphQL error rate above 5%
          description: |
            GraphQL error rate exceeded 5% over the last 5 minutes (current={{ $value | humanizePercentage }}).
